
{% for p in proxy_hosts %}
{{ p.host }} {
{% if p.logging_enabled | default(false) %}
    import logging "{{ p.host | replace(' ', ',') | replace(',,', ',') | split(',') | first }}"
{% endif %}
{% if (p.basic_auth | default({})) | length > 0 %}
    basic_auth / {
{% for user, pass in (p.basic_auth | default({})).items() %}
{% if pass | regex_search('^\$2[ayb]\$[0-9]{2}\$[A-Za-z0-9\.\/]+$') %}
        {{ user }} {{ pass }}
{% else %}
        {{ user }} {{ pass | password_hash(hashtype='bcrypt') }}
{% endif %}
{% endfor %}
    }
{% endif %}
{% if p.ignore_ssl | default(false) %}
	reverse_proxy {{ p.target }} {
		transport http {
			tls_insecure_skip_verify
		}
	}
{% else %}
    reverse_proxy {{ p.target }}
{% endif %}
    {{ p.additional_config | default('') | indent(width=4) }}
}

{% endfor %}
